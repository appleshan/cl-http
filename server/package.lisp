;;;   -*- Mode: LISP; Package: CL-USER; BASE: 10; Syntax: ANSI-Common-Lisp; Default-Character-Style: (:FIX :ROMAN :NORMAL);-*-
;;;
;;; (c) Copyright 1994-2001, 2003, 2005-2006, John C. Mallery
;;;     All Rights Reserved.
;;;

;;;------------------------------------------------------------------- 
;;;
;;; PACKAGE DEFINITIONS
;;;

(in-package :cl-user)

#-Genera
(eval-when (:compile-toplevel :execute :load-toplevel)
  (defmacro add-nickname (package nickname)
    #+(or allegro Franz-Inc)
    `(defpackage ,package (:nicknames ,@(adjoin nickname (package-nicknames package))))
    #+clisp
    `(let ((pkg (find-package ,package)))
       (ext:without-package-lock ()
                                 (rename-package pkg (package-name pkg) (adjoin ,nickname (package-nicknames pkg)))))
    #+(or Lucid MCL LispWorks CMU scl sbcl cormanlisp ecl clozure-common-lisp)
    `(let ((pkg (find-package ,package)))
       (rename-package pkg (package-name pkg) (adjoin ,nickname (package-nicknames pkg))))
    #-(or Franz-Inc allegro Lucid MCL LispWorks CMU scl sbcl cormanlisp clisp ecl clozure-common-lisp)
    `(error "You need to define add-nickname"))
  
  ;;mimize conditionalization
  (add-nickname "COMMON-LISP" "FUTURE-COMMON-LISP"))

;;;------------------------------------------------------------------- 
;;;
;;; UTILITIES
;;;

(defpackage base64
  (:use future-common-lisp)
  (:export
    ;; conditions
    "BASE64-DECODE-ERROR"
    "BASE64-INVALID-DATA-ERROR"
    "BASE64-ODD-SIZE-ERROR"
    ;; operations
    "BASE64-ENCODE-VECTOR"
    "BASE64-DECODE-VECTOR"
    "WITH-ENCODING-VECTOR"
    "BASE64-ENCODE-INTEGER-INTO-STRING"
    "BASE64-DECODE-STRING-INTO-INTEGER"))

(defpackage md5
  (:use future-common-lisp)
  (:export
    "MD5-ENCODE"
    "MD5-ENCODE-STRING"
    "MD5-DIGEST-BYTE-VECTOR"
    "MD5-DIGEST-EQUAL"
    "MD5-DIGEST-HEXADECIMAL-STRING"
    "MD5-DIGEST-HEXADECIMAL-STRING-FROM-FILE"
    "MD5-DIGEST-LIST"
    "MD5-DIGEST-VECTOR"
    "MAKE-MD5-BUFFER-FILLER-FROM-READER-FUNCTION"
    "MAKE-FILTERED-READER-FUNCTION"
    "MD5-WITH-TEMPORARY-DIGEST-STRING"))

(defpackage sha
  (:use future-common-lisp)
  (:export
    "SHA-COMPRESS"
    "SHA-ENCODE"
    "SHA-MAC-ENCODE"
    "SHA-DIGEST-BYTE-VECTOR"
    "SHA-DIGEST-EQUAL"
    "SHA-DIGEST-HEXADECIMAL-STRING"
    "SHA-DIGEST-INTEGER"
    "SHA-DIGEST-LIST"
    "SHA-DIGEST-VECTOR"
    "SHA-MAC-HEXADECIMAL-STRING"
    "SHA-MAC-INTEGER"
    "MAKE-SHA-BUFFER-FILLER-FROM-READER-FUNCTION"
    "MAKE-FILTERED-READER-FUNCTION"))

(defpackage www-utils
  (:use future-common-lisp)
  #+Genera
  (:shadow "DIRECTORY")
  (:export
   "%CHAR-EQUAL"
   "%HOST-LOG-NAME"
   "%LOCAL-HOST-DOMAIN-NAME"
   "%MAKE-LOG-PATHNAME"
   #+CL-HTTP-SSL "*SSL-CIPHER-SETS*"
   #+CL-HTTP-SSL "*SSL-VERSIONS*"
   "ABORT-CURRENT-CONNECTION"
   "ABORT-IF-CONNECTION-DEAD"
   "ADD-INITIALIZATION"
   "ADD-PERIODIC-TASK"
   "ARGLIST"
   "ATOMIC-CONDITIONAL-REPLACEF"
   "ATOMIC-DECF"
   "ATOMIC-INCF"
   "ATOMIC-POP"
   "ATOMIC-PUSH"
   "ATOMIC-REPLACEF"
   "AUTOTYPE-FILE"
   "BASIC-COMMON-FILE-LOG"
   "BASIC-EXTENDED-COMMON-FILE-LOG"
   "CHAR-BITS"
   "COMMON-LOGFILE-NOTIFY"
   "COND-EVERY"
   "COPY-VECTOR-PORTION"
   "CREATE-DIRECTORIES-RECURSIVELY"
   "CURRENT-PROCESS"
   "DAY-OF-THE-WEEK-STRING"
   "DECODE-BITMASK"
   "DEFINE"
   "DEFINE-CONSTANT"
   "DEFINE-GENERIC"
   "DEFINE-MACRO"
   "DEFINE-PARAMETER"
   "DEFINE-VARIABLE"
   "DELETE-INITIALIZATION"
   "DELETE-PERIODIC-TASK"
   "DIRECTORY-INFO"
   "DIRECTORY-LIST*"
   "DOMAIN-NAME-FOR-IP-ADDRESS"
   "DOMAIN-NAME-FOR-PARSED-IP-ADDRESS"
   "ENSURE-HTTP-PROTOCOL-ON-PORT"
   "FILE-CREATION-DATE"
   "FILE-LENGTH-IN-BYTES"
   "FILE-MODIFICATION-DATE"
   "FILE-PROPERTIES"
   "FILE-VERSION"
   "FILE-STREAM-CREATION-DATE"
   "FILE-STREAM-LENGTH-IN-BYTES"
   "FILE-STREAM-MODIFICATION-DATE"
   "FILE-STREAM-PATHNAME"
   "FILE-STREAM-VERSION"
   "FILE-URL-DIRECTORY-INFO"
   "FILE-URL-COPY-FILE"
   "FOREIGN-HOST"
   "FOREIGN-PORT"
   "GENERATE-MESSAGE-ID"
   "GMT-TIME"
   "HOST-EQ"
   "HOST-MAIL-NAME"
   "HOST-HTTP-NAME"
   "INDEX-DEFINITIONS"
   "IP-ADDRESS-FOR-HOST-DOMAIN-NAME"
   "IP-ADDRESS-FOR-PARSED-IP-ADDRESS"
   "IP-ADDRESS-MATCH-P"
   "IP-HOST-TRUSTED-P"
   "LET-IF"
   "LIVE-CONNECTION-P"
   "LOAD-HTTP-LOGICAL-HOST"
   "LOCAL-HOST"
   "LOCAL-HOST-DOMAIN-NAME"
   "LOCAL-HOST-IP-ADDRESS-MOVED-P"
   "LOCAL-HOST-IP-ADDRESS"
   "LOCAL-HOST-PARSED-IP-ADDRESS"
   "LOCAL-PORT"
   "LOCAL-PROTOCOL"
   "MAKE-LOCK"
   "MAP-BITMASK"
   "MAP-HTTP-SERVERS"
   "MAP-ALL-PROCESSES"
   "MONTH-STRING"
   "NETWORK-ERROR-MIXIN"
   "NEXT-3AM-UNIVERSAL-TIME"
   "NOTIFY-LOG-WINDOW"
   "PARSE-GMT-TIME"
   "PARSE-UNIVERSAL-TIME"
   "PARSE-HOST"
   "%PARSE-INTERNET-ADDRESS"
   "PATHNAME-AS-DIRECTORY"
   "PATHNAME-DIRECTORY-MOST-SPECIFIC-NAME"
   "PATHNAME-DIRECTORY-P"
   "PATHNAME-EXTERNAL-NAME-STRING"
   "PORT-ADDRESS"
   "PORT-PROTOCOL"
   "PRINT-GMT-TIME"
   "PROBE-DIRECTORY"
   "READ-DELIMITED-LINE"
   "READ-IMAGE"
   "REPORT-CONDITION"
   "REPORT-STRING"
   "REPORT-BUG"
   "RESET-INITIALIZATIONS"
   "REVERSE-MAP-BITMASK"
   "RUN-INITIALIZATIONS"
   "RUN-DAILY-SERVER-TASKS"
   "SEND-MAIL-FROM"
   "SERVER-MAIL-ADDRESS"
   "SET-FILE-AUTHOR"
   "SET-FILE-CREATION-DATE"
   "SET-FILE-MODIFICATION-DATE"
   "%SERVER-VERSION-INFO"
   "SHOW-INITIALIZATIONS"
   "SHOW-PERIODIC-TASKS"
   "SHOW-IMAGE"
   #+CL-HTTP-SSL
   "SSL-IMPLEMENTATION"
   "STRING-THIN"
   "SYMBOL-FBOUND-P"
   "SYNCHRONIZE-DAILY-SERVER-TASKS"
   "SYNCHRONIZE-IDLE-HTTP-PROCESS-SCAVENGER"
   "TCP-SERVICE-PORT-NUMBER"
   "TIME-PARSE-ERROR"
   "TIME-ZONE"
   "USER-MAIL-ADDRESS"
   "WRITE-POSITIVE-FIXNUM"
   "WITH-AUTOMATIC-LOGIN"
   "WITH-CRLF-STREAM"
   "WITH-TEXT-STREAM"
   "WITH-FAST-ARRAY-REFERENCES"
   "WITH-BINARY-STREAM"
   "WITH-LOCK-HELD"
   "WITH-NULL-STREAM"))

;;;------------------------------------------------------------------- 
;;;
;;; URL PACKAGE DEFINITION
;;;

(defpackage url
  (:use future-common-lisp www-utils)
  (:shadow "PARSE-HOST")
  (:export
   ;; Variables
   "*DEFAULT-URI-TABLE-SIZE*"
   "*DOWNCASE-URL-STRINGS*"
   "*ESCAPE-SEARCH-URLS*"
   "*URL-HOST-NAME-RESOLUTION*"
   "*PATHNAME-APPLICATION-EXTENSIONS*"
   "*PATHNAME-AUDIO-EXTENSIONS*"
   "*PATHNAME-HTML-EXTENSIONS*"
   "*PATHNAME-IMAGE-EXTENSIONS*"
   "*PATHNAME-LISP-EXTENSIONS*"
   "*PATHNAME-TEXT-EXTENSIONS*"
   "*PATHNAME-VIDEO-EXTENSIONS*"
   "*QUALIFY-UNQUALIFIED-DOMAIN-NAMES*"
   "*RELATIVIZE-URLS*"
   "*SEARCH-URL-SIGNAL-BAD-FORM-ENCODING*"
   "*URL-HOST-NAME-RESOLUTION*"
   "*XML-SAFE-SEARCH-DELIMITERS*"
   ;;URL CLASSES
   "ALTERNATE-URL-MIXIN"
   "AUTHENTICATION-MIXIN"
   "AUTHORITY"
   "COMPUTED-URL-MIXIN"
   "CONTENT-LANGUAGE-MIXIN"
   "DOCUMENTATION-MIXIN"
   "EXPIRATION-MIXIN"
   "FILE-DATA-CACHING-MIXIN"
   "FILE-DATA-CACHING-OBJECT"
   "FILE-DATA-CACHING-PATH"
   "FILE-DIRECTORY"
   "FILE-PATHNAME"
   "FTP-DIRECTORY"
   "FTP-PATHNAME"
   "FTP-URL"
   "GOPHER-OBJECT"
   "GOPHER-PATH"
   "GOPHER-SEARCH"
   "GOPHER-URL"
   "INTERN-PATHNAME-AS-HTTP-URL"               ;IMPLEMENT IN EXTENSIBLE WAY
   "HTTP-FORM"
   "FORM-PROCESSING-MIXIN"
   "HTTP-AUTHORITY"
   "HTTP-CACHE-CONTROL-MIXIN"
   "HTTP-CLIENT-SCRIPT"
   "HTTP-COMPUTED-FORM"
   "HTTP-COMPUTED-URL"
   "HTTP-DYNAMIC-FORM"
   "HTTP-DYNAMIC-FORM-INSTRUCTIONS"
   "HTTP-DYNAMIC-SURVEY-INSTRUMENT"
   "HTTP-MINIMUM-OBJECT"
   "HTTP-OBJECT"
   "HTTP-PATH"
   "HTTP-SEARCH"
   "HTTP-SEARCHABLE-OBJECT"
   "HTTP-TEMPLATE-OBJECT"
   "HTTP-URL"
   "HTTP-VIRTUAL-OBJECT"
   "HTTP-URI"
   "HTTPS-URL"
   "HTTPS-CLIENT-SCRIPT"
   "HTTPS-COMPUTED-FORM"
   "HTTPS-COMPUTED-URL"
   "HTTPS-DYNAMIC-FORM"
   "HTTPS-DYNAMIC-FORM-INSTRUCTIONS"
   "HTTPS-DYNAMIC-SURVEY-INSTRUMENT"
   "HTTPS-FORM"
   "HTTPS-MINIMUM-OBJECT"
   "HTTPS-OBJECT"
   "HTTPS-PATH"
   "HTTPS-SEARCH"
   "HTTPS-SEARCHABLE-OBJECT"
   "HTTPS-TEMPLATE-OBJECT"
   "HTTPS-URL"
   "HTTPS-VIRTUAL-OBJECT"
   "MAIL-ADDRESS"
   "MAILTO-URL"
   "MUTATING-CLASS-MIXIN"
   "NEWS-ARTICLE"
   "NEWS-GROUP"
   "NEWS-URL"
   "REVERSE-PROXY-HTTP-OBJECT"
   "REVERSE-PROXY-HTTP-PATH"
   "REVERSE-PROXY-HTTP-SEARCH"
   "REVERSE-PROXY-HTTP-SEARCHABLE-OBJECT"
   "REVERSE-PROXY-HTTP-URL"
   "REVERSE-PROXY-HTTPS-OBJECT"
   "REVERSE-PROXY-HTTPS-PATH"
   "REVERSE-PROXY-HTTPS-SEARCH"
   "REVERSE-PROXY-HTTPS-SEARCHABLE-OBJECT"
   "REVERSE-PROXY-HTTPS-URL"
   "REVERSE-PROXY-MIXIN"
   "RTSP-URL"
   "SECURE-SUBNETS-MIXIN"
   "SERVER-TIMEOUT-MIXIN"
   "TELNET-URL"
   "TRANSLATION-METHOD-MIXIN"
   "URI"
   "URI-UNIVERSE"
   "URL"
   "WAIS-DOC"
   "WAIS-SEARCH"
   "WAIS-URL"
   ;; Errors And Conditions
   "BAD-HOST-PORT-SPECIFICATION"
   "HOST-PARSING-ERROR"
   "NO-INTERNED-URL-FOUND"
   "NO-PARSER-FOR-SCHEME"
   "PARSING-ERROR"
   "SEARCH-URL-BAD-FORM-ENCODING"
   "UNKNOWN-URI"
   ;; Functions
   "%PROTOCOL-FOR-URL-STRING"
   "%SCHEME-PREFIX-FOR-PROTOCOL"
   "ADD-KEYWORD"
   "ALTERNATE-URLS"
   "AUTHENTICATION-REALM"
   "AVERAGE-RESPONSE-TIMES"
   "CACHED-PATHNAME"
   "CACHE-CONTROL-DIRECTIVES"
   "CANONICALIZE-URL"
   "CAPABILITIES"
   "CHANGE-HOST"
   "CHARACTER-SET"
   "CLEAR-ALL-TEMPLATE-CACHES"
   "CLEAR-RESPONSE-TIMES"
   "CLEAR-TEMPLATE-CACHE"
   "CLEAR-URL-METERING-CACHES"
   "COERCE-URL-STRING"
   "COERCE-URL-STRING*"
   "CONTENT-TYPE-KEYWORD"
   "COPY-MODE"
   "DEFINE-SCHEME-PARSER"
   "DESCRIPTION"
   "DATA-TYPE"
   "DATA-TYPE-KEYWORD-P"
   "DATA-TYPE-PATHNAME-EXTENSIONS"
   "DATA-TYPE-PATHNAME-PREDICATE"
   "DIRECTORY-CONTEXT-STRING"
   "DIRECTORY-NAME-STRING"
   "DIRECTORY-WRITER"
   "DISPLAY-STRING"
   "DYNAMIC-FORM"
   "DOCUMENT-VERSION"
   "ELEMENT-TYPE"
   "EMAIL-ADDRESS"
   "ENTITY-TAG"
#|   "ESCAPED-NAME-STRING"
     "ESCAPED-RELATIVE-NAME-STRING"|#
   "EXPLICIT-EXPIRATION-P"
   "EXPIRATION-FUNCTION"
   "EXPIRATION-UNIVERSAL-TIME"
   "EXPORT-TYPE"
   "EXTENSION"
   "EXTERNAL-NAME-STRING"
   "FORM-FUNCTION"
   "FILE-URL-PATHNAME"
   "FULL-EMAIL-ADDRESS"
   "FULLY-QUALIFIED-URL-STRING-P"
   "GC-URL-TABLE"
   "GET-IMAGE-SIZE"
   "HEADER-FUNCTION"
   "HOST-MATCH-P"
   "HOST-OBJECT"
   "HOST-PORT"
   "HOST-STRING"
   "IMAGE-SIZE"
   "INHERIT-PARENT-ACCESS-CONTROLS"
   "INITIALIZE-AUTHENTICATION"
   "INITIALIZE-DOCUMENTATION"
   "INITIALIZE-EXPIRATION"
   "INITIALIZE-RESPONSE-CACHE-CONTROL-DIRECTIVES"
   "INITIALIZE-SECURE-SUBNETS"
   "INITIALIZE-SPECIALIZATION"
   "INTERN-PATHNAME-AS-URL"
   "INTERN-PATHNAME-AS-URL-INFERIOR"
   "INTERN-URL"
   "INTERN-URL-INFERIOR"
   "KEYWORDS"
   "LANGUAGES"
   "LOAD-BALANCED-URL-STRING"
   "LOCAL-CONTEXT-STRING"
   "LOCAL-URL-P"
   "MAKE-URL-STRING"
   "MAKE-URL-STRING-FROM-PATHNAME"
   "MAP-ACCESS-CONTROLS"
   "MAP-GROUPS"
   "MAP-REALMS"
   "MAP-USERS"
   "MAP-URL-INFERIORS"
   "MAP-URL-TABLE"
   "MAX-AGE-FUNCTION"
   "MAX-AGE-SECONDS"
   "MIME-CONTENT-TYPE-SPEC"
   "MIME-CONTENT-TYPE-MAJOR-TYPE"
   "NAME-STRING"
   "NAME-STRING-WITHOUT-SEARCH-SUFFIX"
   "NAME-STRING-WITHOUT-EXTENSION"
   "NOTE-ORIGIN-CLASS"
   "NOTE-PATHNAME-EXTENSION-TYPE"
   "NUMERIC-HOSTNAME-P"
   "OBJECT"
   "PARSE-ERROR"
   "PARSE-INTERNET-MAIL-ADDRESS"
   "PARSE-SEARCH-INFO"
   "PARSE-SEARCH-INFO-AS-QUERY-ALIST"
   "PARSE-SEARCH-INFO-AS-XML-SAFE-QUERY-ALIST"
   "PARSE-TEMPLATE"
   "PARSE-URL"
   "PATHNAME-APPLICATION-FILE-P"
   "PATHNAME-FILE-URL-STRING"
   "PATHNAME-AUDIO-FILE-P"
   "PATHNAME-HTML-FILE-P"
   "PATHNAME-IMAGE-FILE-P"
   "PATHNAME-LISP-FILE-P"
   "PATHNAME-TEXT-FILE-P"
   "PATHNAME-VIDEO-FILE-P"
   "PATH"
   "PATH-DIRECTORY-STRING"
   "PATH-MOST-SPECIFIC-NAME"
   "PATH-TITLE"
   "PORT"
   "PROTOCOL"
   "PROTOCOL-DEFAULT-PORT"
   "READ-SUBNETS"
   "RELATIVE-NAME-STRING"
   "RELATIVE-NAME-STRING-FOR-LOCALLY-SERVED-URL"
   "RELATIVE-PATH-STRING"
   "RELATIVE-PATH-MATCH-P"
   "REMAP-URL-HOST"
   "REMOVE-KEYWORD"
   "RESPONSE-CACHE-CONTROL-DIRECTIVES"
   "RESPONSE-FUNCTION"
   "REVERSE-PROXY-FORWARDINGS" 
   "REVERSE-PROXY-SUPERIOR"
   "REVERT-CLASS"
   "ROOT-CONTEXT-STRING"
   "ROOT-URL-P"
   "SCHEME"
   "SCHEME-PREFIXED-URL-P"
   "SCRIPT"
   "SEARCH-DATABASE"
   "SEARCH-KEYS"
   "SEARCH-KEYS-GET-VALUE"
   "SEARCH-PARENT"
   "SEARCH-PARSER"
   "SEARCH-SUFFIX"
   "SEARCH-URL-FORM-ENCODING-P"
   "SEARCH-WRITER"
   "SECURE-SUBNETS"
   "STANDARD-PARSE-SEARCH-INFO"
   "STANDARD-WRITE-SEARCH-INFO"
   "SWAP-URL-CONTEXT"
   "TEMPLATE-PARAMETERS"
   "TEMPLATE-SECURE-SUBNETS"
   "TEMPLATE-UPDATE-TIME"
   "TRANSLATION-METHOD"
   "TRANSLATED-PATHNAME"
   "TRUSTED-HOST-P"
   "UNINTERN-URL"
   "URI-P"
   "URL-EQUAL"
   "URL-INTERNED-P"
   "URL-P"
   "URL-POSITION"
   "URL-STRING"
   "URL-SUPERIOR"
   "USER-ID-AND-PASSWORD"
   "VALID-SEARCH-URL-P"
   "WITH-CLASS-CHANGE-FOR-INITIALIZE-SPECIALIZATION"
   "WITH-URL-CLASS-MAP"
   "WITH-URL-SEARCH-PARENT" 
   "WITH-URI-UNIVERSE"
   "WITHOUT-URL-MODIFICATION"
   "WRITE-INTERNET-MAIL-ADDRESS"
   "WRITE-LOCAL-NAME"
   "WRITE-NAME"
   "WRITE-RELATIVE-NAME-STRING"
   "WRITE-URL-CONTEXT"
   "WRITE-SEARCH-INFO"
   "WRITE-SEARCH-INFO-AS-QUERY-ALIST"
   "WRITE-SEARCH-INFO-AS-XML-SAFE-QUERY-ALIST"
   "WRITE-SUBNETS"))

;;;------------------------------------------------------------------- 
;;;
;;; HTML PACKAGES
;;;

(defpackage script
  (:use future-common-lisp www-utils url)
  (:export
   ;; classes
   "JAVA-SCRIPT"
   "JAVA-SCRIPT1.1"
   "JAVA-SCRIPT1.2"
   "JAVA-SCRIPT1.3"
   "JAVA-SCRIPT1.4"
   "JAVA-SCRIPT1.5"
   "SCRIPT"
   ;; normal
   "DEFINE-SCRIPT"
   "DEFINE-SCRIPT-LANGUAGE"
   "EXPORT-SCRIPT"
   "EVENT-CALLER"
   "INTERN-SCRIPT"
   "JAVA-SCRIPT"
   "SCRIPT-BYTES"
   "SCRIPT-CALLER-ARGLIST"
   "SCRIPT-CHARSET"
   "SCRIPT-CONTENT-TYPE"
   "SCRIPT-DISPLAYS-CONTENT-P"
   "SCRIPT-LANGUAGE"
   "SCRIPT-NAME"
   "SCRIPT-URL"
   "SCRIPT-WRITER-ARGLIST"
   "UNINTERN-SCRIPT"
   "WRITE-RAW-SCRIPT"))

(defpackage html2
  (:use future-common-lisp www-utils url)
  (:shadow
    "*OPEN-FORM*"
    "*SECTION-LEVEL*"
    "%ISSUE-COMMAND"
    "%WITH-ENVIRONMENT"
    "%WRITE-COMMAND-KEY-ARG"
    "WITH-ENVIRONMENT"
    "WRITE-STANDARD-INPUT-TYPE-ARGS" 
    "ISSUE-COMMAND"
    "ISSUE-COMMAND*")
  (:export
    ;; Input types for fill out forms
    "CHECKBOX"
    "FILE"
    "HIDDEN"
    "IMAGE"
    "MULTI-LINE-TEXT"
    "PASSWORD"
    "RADIO-BUTTON"
    "RESET-BUTTON"
    "SELECT-CHOICES"
    "STRING"
    "STRING+"                                   ;obsolete
    "SUBMIT-BUTTON"
    "CLIENT-SIDE-BUTTON"
    ;; variables
    "*EVENT-HANDLERS*"
    "*OUTPUT-STREAM*"
    "*SELECT-CHOICES-MAX-DEFAULT-SIZE*"
    ;; Function and macros
    "ACCEPT-INPUT"
    "APROPOS-ISO-CHARACTER"
    "BREAK-LINE"
    "COMMENT"
    "DECLARE-BASE-REFERENCE"
    "DECLARE-LINK"
    "DECLARE-META-INFO"
    "DECLARE-NEXT-IDENTIFIER"
    "DECLARE-SEARCH-INDEX"
    "DECLARE-TITLE"
    "DESCRIBE-ISO-CHARACTER"
    "DESCRIBE-ISO-READTABLE"
    "ENUMERATING-ITEM"
    "GET-INPUT-TYPE"
    "HORIZONTAL-LINE"
    "NEW-PARAGRAPH"
    "NOTE-ANCHOR"
    "PACK-QUERY-NAME"
    "PARSE-ISO-CHARACTER"
    "READ-CHAR-UNQUOTING-SPECIALS"
    "SPECIAL-CHAR-FOR-TOKEN"
    "TOKEN-FOR-SPECIAL-CHAR"
    "UNPACK-QUERY-NAME"
    "VALID-ISO-CHARACTER-CODE-P"
    "WITH-ANCHOR-NOTED"
    "WITH-COMMENT"
    "WITH-DOCUMENT-BODY"
    "WITH-DOCUMENT-PREAMBLE"
    "WITH-EMPHASIS"
    "WITH-ENUMERATION"
    "WITH-FILLOUT-FORM"
    "WITH-HTML-DOCUMENT"
    "WITH-EVENT-HANDLERS"
    "WITH-PARAGRAPH"
    "WITH-PARAGRAPH-STYLE"
    "WITH-RENDITION"
    "WITH-SECTION-HEADING"
    "WITH-VERBATIM-TEXT"
    "WRITE-CHAR-QUOTING-SPECIALS"
    "WRITE-STRING-QUOTING-SPECIALS"
    "WRITE-STRING-ANCHORING-URLS"
    "WRITE-ISO-CHARACTER"
    "WRITE-ISO-CHARACTER-FOR-KEYWORD"
    "WRITE-ISO-CHARACTER-FOR-NAME"))

(defpackage netscape1.1
  (:use future-common-lisp html2 www-utils url)
  (:nicknames ns1.1 ns11)
  (:shadow
    "%BODY-ARG-KEY"
    "*IMAGE-ALIGNMENT-VALUES*"
    "BREAK-LINE"
    "DECLARE-SEARCH-INDEX"
    "ENUMERATE-ITEM-LIST"
    "ENUMERATING-ITEM"
    "HORIZONTAL-LINE"
    "IMAGE"
    "WITH-DOCUMENT-BODY"
    "WITH-ENUMERATION"
    "WITH-PARAGRAPH")
  (:import-from html2
   "%ISSUE-COMMAND"
   "%WITH-ENVIRONMENT"
   "%WRITE-COMMAND-KEY-ARG"
   "WITH-ENVIRONMENT"
   "ISSUE-COMMAND"
   "ISSUE-COMMAND*")
  (:export
    "*BUILT-IN-BACKGROUNDS*"
    "*BUILT-IN-CLIENT-COLORS*"
    "*IMAGE-ALIGNMENT-VALUES*"
    "ADD-COLOR"
    "BACKGROUND-URL"
    "BACKGROUND-URL-KEYWORD"
    "BREAK-WORD"
    "COLOR-MAPPING"
    "COLOR-MAPPING-KEYWORD"
    "DECODE-COLOR"
    "DECLARE-DEFAULT-FONT-SIZE"
    "DECLARE-REFRESH-RATE"
    "DECLARE-SEARCH-INDEX"
    "DEFINE-COLOR-MAPPING"
    "ENCODE-COLOR"
    "ENUMERATE-ITEM-LIST"
    "ENUMERATING-ITEM"
    "DEFINE-BACKGROUND-MAPPINGS"
    "HORIZONTAL-LINE"
    "IMAGE"
    "INVENT-RANDOM-COLOR"
    "INVERSE-COLOR"
    "RANDOM-BACKGROUND-URL"
    "RANDOM-BACKGROUND-URL-KEYWORD"
    "RANDOM-COLOR"
    "RANDOM-COLOR-KEYWORD"
    "WITH-BLINKING"
    "WITH-CENTERING"
    "WITH-BLOCK"                                ;local macro for with-server-push-response
    "WITH-CAPTION"
    "WITH-DOCUMENT-BODY"
    "WITH-ENUMERATION"
    "WITH-FONT-SIZE"
    "WITH-PARAGRAPH"
    "WITH-SERVER-PUSH-RESPONSE"
    "WITH-TABLE"
    "WITH-TABLE-CELL"
    "WITH-TABLE-ROW"
    "WITHOUT-LINE-BREAKS"))

(defpackage netscape2.0
  (:use future-common-lisp ns1.1 www-utils url script)
  (:nicknames ns2.0)
  (:shadow
   "DECLARE-BASE-REFERENCE"
   "DECLARE-DEFAULT-FONT-SIZE"                 ;new name in 2.0
   "DECLARE-SCRIPT"
   "IMAGE"
   "MULTI-LINE-TEXT"
   "NOTE-ANCHOR"
   "WITH-RENDITION"
   "WITH-ANCHOR-NOTED"
   "WITH-DOCUMENT-BODY"                        ;events added in 2.0
   "WITH-FONT-SIZE"                            ;new name in 2.0
   "WITH-FILLOUT-FORM"
   "%WRITE-TARGET-WINDOW-COMMAND-KEY-ARG"
   "WRITE-SCRIPT")
  (:import-from html2
   "*EVENT-HANDLERS*"
   "*OPEN-FORM*"
   "%WRITE-COMMAND-KEY-ARG"
   "%ISSUE-COMMAND"
   "%WITH-ENVIRONMENT"
   "WITH-ENVIRONMENT"
   "WRITE-STANDARD-INPUT-TYPE-ARGS"
   "ISSUE-COMMAND"
   "ISSUE-COMMAND*"
   "WITH-EVENT-HANDLERS")
  (:import-from ns1.1
   "%BODY-ARG-KEY")
  (:export
   "*EVENT-HANDLERS*"
   ;; functions and macros
   "CLIENT-IMAGE-AREA"
   "CLIENT-TARGET-WINDOW-HTTP-HEADERS"
   "DECLARE-BASE-REFERENCE"
   "DECLARE-DEFAULT-FONT"
   "DECLARE-SCRIPT"
   "EMBED-OBJECT"
   "IMAGE"
   "MULTI-LINE-TEXT"
   "NOTE-ANCHOR"
   "NOTE-DOCUMENT-FRAME"
   "NOTE-JAVA-PARAMETER"
   "SPECIAL-TARGET-WINDOW-NAME"
   "WITH-ANCHOR-NOTED"
   "WITH-CLIENT-IMAGE-MAP"
   "WITH-DIVISION"
   "WITH-DOCUMENT-BODY"
   "WITH-DOCUMENT-FRAMESET"
   "WITH-EMBEDDED-SCRIPT"
   "WITH-EVENT-HANDLERS"
   "WITH-FILLOUT-FORM"
   "WITH-FONT"
   "WITH-JAVA-APPLET"
   "WITH-PARAGRAPH"
   "WITH-RENDITION"
   "WITHOUT-FRAME-CAPABILITY"
   "WRITE-CLIENT-SIDE-IMAGE-MAP"
   "WRITE-SCRIPT"))

(defpackage netscape3.0
  (:use future-common-lisp ns2.0 www-utils url script)
  (:nicknames ns3.0)
  (:shadow
   "IMAGE"
   "NOTE-DOCUMENT-FRAME"
   "WITH-DOCUMENT-FRAMESET"
   "WITH-FONT"
   "WITH-RENDITION"
   "WITH-TABLE"
   "WITH-TABLE-CELL"
   "WITH-TABLE-ROW"
   "%WRITE-MAKE-FONT-ARGS")
  (:import-from html2
   "%WRITE-COMMAND-KEY-ARG"
   "%ISSUE-COMMAND"
   "%WITH-ENVIRONMENT"
   "WITH-ENVIRONMENT"
   "ISSUE-COMMAND"
   "ISSUE-COMMAND*")
  (:import-from ns2.0
   "%WRITE-TARGET-WINDOW-COMMAND-KEY-ARG")
  (:export
   "*EVENT-HANDLERS*"
   "IMAGE"
   "NOTE-DOCUMENT-FRAME"
   "NOTE-SPACING"
   "WITH-DOCUMENT-FRAMESET"
   "WITH-EVENT-HANDLERS"
   "WITH-FONT"
   "WITH-MULTIPLE-COLUMNS"
   "WITH-RENDITION"
   "WITH-TABLE"
   "WITH-TABLE-CELL"
   "WITH-TABLE-ROW"))

(defpackage html3.2
  (:use future-common-lisp html2 www-utils url script)
  #+Use-HTML3.2
  (:nicknames html)
  (:shadow
   "*EVENT-HANDLERS*"                          ; no events 3.2
   "DECLARE-LINK"                              ; revised in 3.2
   "DECLARE-NEXT-IDENTIFIER"                   ; eliminated in 3.2
   "ENUMERATE-ITEM-LIST"
   "ENUMERATING-ITEM"
   "NOTE-ANCHOR"
   "WITH-ANCHOR-NOTED"
   "WITH-EMPHASIS"
   "WITH-ENUMERATION"
   "WITH-EVENT-HANDLERS"                       ; no events 3.2
   "WITH-FILLOUT-FORM"                         ; no events 3.2
   "WITH-HTML-DOCUMENT"                        ; superseded in 3.2
   "WITH-PARAGRAPH"
   "WITH-PARAGRAPH-STYLE"
   "WITH-RENDITION"
   "WITH-SECTION-HEADING")                     ; revised in 3.2
  (:import-from html2
   "*SECTION-LEVEL*"                            ;interoperate between different packages
   "%WRITE-COMMAND-KEY-ARG"
   "%ISSUE-COMMAND"
   "%WITH-ENVIRONMENT"
   "ISSUE-COMMAND"
   "ISSUE-COMMAND*"
   "WITH-ENVIRONMENT") 
  (:shadowing-import-from ns1.1
   "*BUILT-IN-BACKGROUNDS*"
   "*BUILT-IN-CLIENT-COLORS*"
   "ADD-COLOR"
   "BACKGROUND-URL"
   "BACKGROUND-URL-KEYWORD"
   "COLOR-MAPPING"
   "COLOR-MAPPING-KEYWORD"
   "DECODE-COLOR"
   "DEFINE-COLOR-MAPPING"
   "ENCODE-COLOR"
   "DEFINE-BACKGROUND-MAPPINGS"
   "INVENT-RANDOM-COLOR"
   "INVERSE-COLOR"
   "RANDOM-BACKGROUND-URL"
   "RANDOM-BACKGROUND-URL-KEYWORD"
   "RANDOM-COLOR"
   "RANDOM-COLOR-KEYWORD"
   ;; regular stuff
   "BREAK-LINE"
   "DECLARE-SEARCH-INDEX" 
   "HORIZONTAL-LINE"
   "WITH-DOCUMENT-BODY" )
  (:shadowing-import-from ns2.0
   "DECLARE-DEFAULT-FONT"
   "DECLARE-SCRIPT"
   "NOTE-JAVA-PARAMETER"
   "WITH-CLIENT-IMAGE-MAP"
   "WITH-JAVA-APPLET"
   "WRITE-CLIENT-SIDE-IMAGE-MAP"
   "WRITE-SCRIPT")
  (:shadowing-import-from ns3.0
   "IMAGE")
  (:export
   ;; color utilities
   "*BUILT-IN-BACKGROUNDS*"
   "*BUILT-IN-CLIENT-COLORS*"
   "*STANDARD-COLOR-SCHEME*"
   "ADD-COLOR"
   "BACKGROUND-URL"
   "BACKGROUND-URL-KEYWORD"
   "COLOR-MAPPING"
   "COLOR-MAPPING-KEYWORD"
   "COLOR-SCHEME"
   "COLOR-SCHEME-BACKGROUND"
   "COLOR-SCHEME-BACKGROUND-URL"
   "COLOR-SCHEME-FOREGROUND"
   "COLOR-SCHEME-LINK"
   "COLOR-SCHEME-VISITED-LINK"
   "COLOR-SCHEME-ACTIVE-LINK"
   "CREATE-COLOR-SCHEME"
   "DECODE-COLOR"
   "DEFINE-COLOR-MAPPING"
   "ENCODE-COLOR"
   "DEFINE-BACKGROUND-MAPPINGS"
   "INVENT-RANDOM-COLOR"
   "INVERSE-COLOR"
   "RANDOM-BACKGROUND-URL"
   "RANDOM-BACKGROUND-URL-KEYWORD"
   "RANDOM-COLOR"
   "RANDOM-COLOR-KEYWORD"
   "WITH-STANDARD-DOCUMENT-BODY"
   ;;normal stuff
   "*DEFAULT-TWISTDOWN-TREE-APPLET-HORIZONTAL-SPACE*"
   "APROPOS-ISO-CHARACTER"
   "BREAK-LINE"
   "CLIENT-IMAGE-AREA"
   "COMMENT"
   "COMPUTE-TWISTDOWN-TREE-APPLET-VERTICAL-SPACE"
   "DECLARE-DEFAULT-FONT"
   "DECLARE-LINK"
   "DECLARE-SCRIPT"
   "DECLARE-SEARCH-INDEX"
   "DESCRIBE-ISO-CHARACTER"
   "DESCRIBE-ISO-READTABLE"
   "ENUMERATE-ITEM-LIST"
   "ENUMERATING-ITEM"
   "FILE"
   "GENERATE-TWISTDOWN-TREE"
   "HORIZONTAL-LINE"
   "IMAGE"
   "NEW-PARAGRAPH"
   "NOTE-ANCHOR"
   "NOTE-JAVA-PARAMETER"
   "PACK-QUERY-NAME"
   "PARSE-ISO-CHARACTER"
   "READ-CHAR-UNQUOTING-SPECIALS"
   "SPECIAL-CHAR-FOR-TOKEN"
   "TOKEN-FOR-SPECIAL-CHAR"
   "UNPACK-QUERY-NAME"
   "VALID-ISO-CHARACTER-CODE-P"
   "WITH-ANCHOR-NOTED"
   "WITH-CAPTION"
   "WITH-CENTERING"
   "WITH-CLIENT-IMAGE-MAP"
   "WITH-COMMENT"
   "WITH-DIVISION"
   "WITH-DOCUMENT-BODY"
   "WITH-EMPHASIS"
   "WITH-ENUMERATION"
   "WITH-FILLOUT-FORM"
   "WITH-FONT"
   "WITH-HTML-DOCUMENT"
   "WITH-JAVA-APPLET"
   "WITH-PARAGRAPH"
   "WITH-PARAGRAPH-STYLE"
   "WITH-RENDITION"
   "WITH-SECTION-HEADING"
   "WITH-TABLE"
   "WITH-TABLE-CELL"
   "WITH-TABLE-ROW"
   "WRITE-CHAR-QUOTING-SPECIALS"
   "WRITE-CLIENT-SIDE-IMAGE-MAP"
   "WRITE-ISO-CHARACTER"
   "WRITE-ISO-CHARACTER-FOR-KEYWORD"
   "WRITE-ISO-CHARACTER-FOR-NAME"
   "WRITE-SCRIPT"))

(defpackage netscape4.0
  (:use future-common-lisp ns3.0 www-utils url script)
  (:nicknames ns4.0)
  (:shadow "WITH-FONT")
  (:shadowing-import-from html3.2
   "*STANDARD-COLOR-SCHEME*"
   "COLOR-SCHEME"
   "CREATE-COLOR-SCHEME"
   "DECLARE-LINK"
   "ENUMERATE-ITEM-LIST"
   "ENUMERATING-ITEM"
   "WITH-CENTERING"
   "WITH-DIVISION"
   "WITH-ENUMERATION"
   "WITH-PARAGRAPH"
   "WITH-PARAGRAPH-STYLE"
   "WITH-SECTION-HEADING"
   "WITH-STANDARD-DOCUMENT-BODY")
  (:export
   "*STANDARD-COLOR-SCHEME*"
   "COLOR-SCHEME"
   "CREATE-COLOR-SCHEME"
   "DECLARE-LINK"
   "ENUMERATE-ITEM-LIST"
   "ENUMERATING-ITEM"
   "JAVA-SCRIPT1.2"
   "WITH-CENTERING"
   "WITH-DIVISION"
   "WITH-ENUMERATION"
   "WITH-FONT"
   "WITH-LAYER"
   "WITH-PARAGRAPH"
   "WITH-PARAGRAPH-STYLE"
   "WITH-SECTION-HEADING"
   "WITH-STANDARD-DOCUMENT-BODY"
   "WITHOUT-LAYERS-CAPABILITY"))

(defpackage html4.0
  (:use future-common-lisp html3.2 www-utils url script)
  #-Use-HTML3.2
  (:nicknames "HTML")
  (:shadow
   "%WRITE-COMMAND-KEY-ARG"
   "%ISSUE-COMMAND"
   "*DTD-VERSION*"
   "ACCEPT-INPUT"
   "APROPOS-ISO-CHARACTER"
   "BREAK-LINE"
   "CHECKBOX"
   "CLIENT-IMAGE-AREA"
   "CLIENT-SIDE-BUTTON"
   "DECLARE-BASE-REFERENCE"
   "DECLARE-DEFAULT-FONT"
   "DECLARE-DOCUMENT-STYLE"
   "DECLARE-HTML-VERSION"
   "DECLARE-LINK"
   "DECLARE-META-INFO"
   "DECLARE-SCRIPT"
   "DECLARE-SEARCH-INDEX"
   "DECLARE-TITLE"
   "DEFINE-INPUT-TYPE"
   "DESCRIBE-ISO-CHARACTER"
   "DESCRIBE-ISO-READTABLE"
   "ENUMERATING-ITEM"
   "ENUMERATE-ITEM-LIST"
   "FILE"
   "GET-INPUT-TYPE"
   "HIDDEN"
   "HORIZONTAL-LINE"
   "IMAGE"
   "MULTI-LINE-TEXT"
   "NEW-PARAGRAPH" ;obsolete html2 operator
   "NOTE-ANCHOR"
   "NOTE-JAVA-PARAMETER"
   "PASSWORD"
   "PARSE-ISO-CHARACTER"
   "RADIO-BUTTON"
   "RESET-BUTTON"
   "SELECT-CHOICES"
   "STRING+"
   "SUBMIT-BUTTON"
   "VALID-ISO-CHARACTER-CODE-P"
   "WITH-ANCHOR-NOTED"
   "WITH-CAPTION"
   "WITH-CENTERING"
   "WITH-CLIENT-IMAGE-MAP"
   "WITH-DOCUMENT-BODY"
   "WITH-DOCUMENT-PREAMBLE"
   "WITH-DIVISION"
   "WITH-FILLOUT-FORM"
   "WITH-EMPHASIS"
   "WITH-ENUMERATION"
   "WITH-FONT" 
   "WITH-HTML-DOCUMENT"
   "WITH-JAVA-APPLET"
   "WITH-PARAGRAPH"
   "WITH-PARAGRAPH-STYLE"
   "WITH-RENDITION"
   "WITH-SECTION-HEADING"
   "WITH-STANDARD-DOCUMENT-BODY"
   "WITH-TABLE"
   "WITH-TABLE-CELL"
   "WITH-TABLE-ROW"
   "WITH-VERBATIM-TEXT"
   "WRITE-CLIENT-SIDE-IMAGE-MAP"
   "WRITE-ISO-CHARACTER"
   "WRITE-ISO-CHARACTER-FOR-KEYWORD"
   "WRITE-ISO-CHARACTER-FOR-NAME"
   "WRITE-SCRIPT"
   "WRITE-STRING-ANCHORING-URLS")
  (:import-from "HTML2"
   "*SELECT-CHOICES-MAX-DEFAULT-SIZE*")
  (:export
   "*CHECK-IDENTIFIER-VALIDITY*"
   "*DTD-VERSION*"
   "*EVENT-HANDLERS*"
   "*SELECT-CHOICES-MAX-DEFAULT-SIZE*"
   "*STANDARD-DOCUMENT-LOOK*"
   "ACCEPT-INPUT"
   "APROPOS-ISO-CHARACTER"
   "BREAK-LINE"
   "CHECKBOX"
   "CLIENT-IMAGE-AREA"
   "CLIENT-SIDE-BUTTON"
   "CREATE-DOCUMENT-LOOK"
   "DECLARE-BASE-REFERENCE"
   "DECLARE-DEFAULT-FONT"
   "DECLARE-DOCUMENT-STYLE"
   "DECLARE-HTML-VERSION"
   "DECLARE-LINK"
   "DECLARE-META-INFO"
   "DECLARE-SCRIPT"
   "DECLARE-DOCUMENT-SCRIPT-TYPE"
   "DECLARE-SEARCH-INDEX"
   "DECLARE-TITLE"
   "DEFINE-INPUT-TYPE"
   "DESCRIBE-ISO-CHARACTER"
   "DESCRIBE-ISO-READTABLE"
   "DOCUMENT-LOOK" 
   "DOCUMENT-LOOK-DEFAULT"
   "ENUMERATING-ITEM"
   "ENUMERATE-ITEM-LIST"
   "FILE"
   "GET-INPUT-TYPE"
   "HIDDEN"
   "HORIZONTAL-LINE"
   "HTML4-GENERATION-ERROR"
   "IMAGE"
   #|  "IM-TAB-INDEX-DEFAULT"
  "IM-ACCESS-KEY-DEFAULT"
   "IM-ID-DEFAULT"
   "IM-CLASS-DEFAULT"
   "IM-LANGUAGE-DEFAULT"
   "IM-DIRECTION-DEFAULT"
   "IM-TITLE-DEFAULT"
   "IM-STYLE-DEFAULT"
   "IM-EVENTS-DEFAULT" |#
   "MULTI-LINE-TEXT"
   "NOTE-ANCHOR"
   "NOTE-DOCUMENT-FRAME"
   "NOTE-INLINE-FRAME"
   "NOTE-JAVA-PARAMETER"
   "PASSWORD"
   "PARSE-ISO-CHARACTER"
   "RADIO-BUTTON"
   #|  "REGION-BOUNDING-SHAPE"
   "REGION-NAME"
   "REGION-TAB-INDEX"
   "REGION-ACCESS-KEY"
   "REGION-ID"
   "REGION-CLASS"
   "REGION-LANGUAGE"
   "REGION-DIRECTION"
   "REGION-TITLE"
   "REGION-STYLE"
   "REGION-EVENTS" |#
   "RESET-BUTTON"
   "SELECT-CHOICES"
   "STRING+" ;obsolete
   "SUBMIT-BUTTON"
   "TABLE-COLUMN-GROUP"
   "USER-DOCUMENT-LOOK"
   "VALID-ISO-CHARACTER-CODE-P"
   "WITH-ANCHOR-NOTED"
   "WITH-CAPTION"
   "WITH-CENTERING"
   "WITH-CLIENT-IMAGE-MAP"
   "WITH-DOCUMENT-BODY"
   "WITH-DOCUMENT-FRAMESET"
   "WITH-DOCUMENT-LOOK" 
   "WITH-DOCUMENT-LOOK-BODY" 
   "WITH-DOCUMENT-LOOK-HTML" 
   "WITH-DOCUMENT-LOOK-PREAMBLE"
   "WITH-DOCUMENT-PREAMBLE"
   "WITH-DOCUMENT-STYLE-DECLARED"
   "WITH-DIVISION"
   "WITH-EDITING-CHANGE"
   "WITH-EMPHASIS"
   "WITH-ENUMERATION"
   "WITH-EVENT-HANDLERS"
   "WITH-FILLOUT-FORM"
   "WITH-FONT"
   "WITH-FORM-BUTTON"
   "WITH-FORM-CONTROL-LABEL"
   "WITH-FORM-FIELD-LEGEND"
   "WITH-FORM-FIELD-SET"
   "WITH-HTML-DOCUMENT"
   "WITH-JAVA-APPLET"
   "WITH-LANGUAGE-DIRECTION"
   "WITH-OBJECT"
   "WITH-PARAGRAPH"
   "WITH-PARAGRAPH-STYLE"
   "WITH-RENDITION"
   "WITH-SCRIPT"
   "WITH-STANDARD-DOCUMENT-BODY"
   "WITH-TABLE"
   "WITH-TABLE-CELL"
   "WITH-TABLE-COLUMN-GROUP"
   "WITH-TABLE-ROW-GROUP"
   "WITH-TABLE-ROW"
   "WITH-TEXT-BLOCK-STYLE"
   "WITH-SECTION-HEADING"
   "WITH-VERBATIM-TEXT"
   "WITHOUT-FRAME-CAPABILITY"
   "WITHOUT-SCRIPT-CAPABILITY"
   "WRITE-CLIENT-SIDE-IMAGE-MAP"
   "WRITE-DOCUMENT-BODY" 
   "WRITE-DOCUMENT-HTML"
   "WRITE-DOCUMENT-PREAMBLE"
   "WRITE-ISO-CHARACTER"
   "WRITE-ISO-CHARACTER-FOR-KEYWORD"
   "WRITE-ISO-CHARACTER-FOR-NAME"
   "WRITE-SCRIPT"
   "WRITE-STRING-ANCHORING-URLS"))

(defpackage xhtml1.0
  (:use future-common-lisp html4.0 www-utils url)
  (:nicknames "XHTML")
  (:shadow  
   "COMMENT"
   "DECLARE-HTML-VERSION"
   "WITH-CLIENT-IMAGE-MAP"
   "WITH-COMMENT"
   "WITH-DOCUMENT-STYLE-DECLARED"
   "WITH-HTML-DOCUMENT"
   "WITH-SCRIPT")
  (:export
   "COMMENT"
   "DECLARE-HTML-VERSION"
   "WITH-CLIENT-IMAGE-MAP"
   "WITH-COMMENT"
   "WITH-DOCUMENT-STYLE-DECLARED"
   "WITH-HTML-DOCUMENT"
   "WITH-SCRIPT"))

;;;------------------------------------------------------------------- 
;;;
;;; RSS 2.0 GENERATION
;;;

(defpackage rss2.0
  (:use future-common-lisp www-utils url)
  (:nicknames rss)
  (:import-from "HTML2"
   "*OUTPUT-STREAM*"
   "%WRITE-COMMAND-KEY-ARG"
   "%ISSUE-COMMAND"
   "%WITH-ENVIRONMENT"
   "ISSUE-COMMAND"
   "ISSUE-COMMAND*"
   "WITH-ENVIRONMENT")
  ;; circular import
  ;;  (:import-from http  "FAST-FORMAT" "WRITE-MIME-CONTENT-TYPE")
  (:export
   "DECLARE-RSS-CHANNEL-IMAGE"
   "DECLARE-RSS-ENCLOSURE"
   "DECLARE-RSS-ITEM"
   "WITH-RSS-CHANNEL"
   "WITH-RSS-DOCUMENT"
   "ENCODING-CHARACTER-DATA"))

;;;------------------------------------------------------------------- 
;;;
;;; HTTP PACKAGE
;;;

(defpackage http
  (:use future-common-lisp www-utils url html)
  (:nicknames http1)
  (:shadow "*SERVER*" "FAST-FORMAT" "WITH-USER-EMAIL-ADDRESS")
  #+Genera
  (:shadowing-import-from :www-utils "DIRECTORY")
  (:export
   "%MIME-CONTENT-TYPE-MAJOR-TYPE"
   "%MIME-CONTENT-TYPE-SPEC"
   "*ACCEPTABLE-TRANSFER-ENCODINGS*"
   "*ACCEPT-WRITE-METHODS*"
   "*ARMOR-PLATED-STRING-LINE-LENGTH*"
   "*AUTHENTICATION-DATA-PATHNAME*"
   "*AUTO-EXPORT*"
   "*BUG-HTTP-SERVER*"
   "*CACHE-DIRECTORY-INDEXES*"
   "*CACHE-HYSTERISIS*"
   "*CGI-VERSION*"
   "*CL-HTTP-HOME-PAGE-URL-STRING*"
   "*CL-HTTP-USER-INIT-FILE*"
   "*CONTENT-NEGOTIATE-DIRECTORY-VIEWS*"
   "CREATE-USER-ACCOUNT+NOTIFY"
   "*DATA-CACHE-WINDOW-FREQUENCY*"
   "*DATA-UNIVERSE-MAXIMUM-CACHE-ELEMENTS*"
   "*DATA-UNIVERSE-MAXIMUM-CACHE-SIZE*"
   "*DATA-UNIVERSE-REVALIDATION-INTERVAL*"
   "*DEBUG-SERVER*"
   "DEFINE-USER-ACCOUNT-INFO-MESSAGE"
   "*DIGEST-AUTHENTICATION-NONCE-LIFE-TIME*"
   "*DURABLE-FORM-VALUES*"
   "*ESCAPED-CHARACTERS*"
   "*FILE-UPLOAD-DEFAULT-DIRECTORY*"
   "*FILE-UPLOAD-MAXIMUM-SIZE*"
   "*HTTP-HOST-NAME*"
   "*HTTP-VERSION*"
   "*IMAGE-SIZES-DEFAULT-AUTOMATICALLY*"
   "*KEYWORD-PACKAGE*"
   "*LINE-BUFFER-SIZE*"
   "*LOCAL-HOST-ADDRESS*"
   "*LOCAL-HOST-DOMAIN-NAME*"
   "*LOCAL-HOST-IP-ADDRESS*"
   "*LOCAL-SCHEME*"
   "*LOG-ACCESS-LOG-CLASS*"
   "*LOG-RESOLVE-IP-ADDRESSES*"
   "*LOG-TIMES-IN-GMT*"
   "*MAXIMUM-NUMBER-OF-CONNECTIONS*"
   "*NUMBER-OF-CONNECTIONS*"
   "*OVERLOAD-MESSAGE*"
   "*PERSISTENT-CONNECTION-MAXIMUM-REQUESTS*"
   "*PERSISTENT-CONNECTION-TIMEOUT*"
   "*POST-FORM-BUFFER-SIZE*"
   "*PRESERVE-HTTP-SERVER-RESOURCES*"
   "*PROXY-SERVICE*"
   "*REALM-ACCESS-CONTROL-TABLE-SIZE*"
   "*REALM-GROUP-TABLE-SIZE*"
   "*REALM-USER-TABLE-SIZE*"
   "*REJECT-CONNECTION-MESSAGE*"
   "*REJECT-CONNECTION-THRESHOLD*"
   "*RESOLVE-IP-ADDRESSES*"
   "*RESOLVE-IP-ADDRESSES-FOR-LOG*"
   "*SEARCH-URL-INTERN-MODE*"
   "*SERVER*"
   "*SERVER-CLASS*"
   "*SERVER-INITIALIZATION-LIST*"
   "*SERVER-INTERFACE-VERSION*"
   "*SERVER-LAUNCH-INITIALIZATION-LIST*"
   "*SERVER-LIFE-TIME*"
   "*SERVER-MAIL-ADDRESS*"
   "*SERVER-TIMEOUT*"
   "*SHUTDOWN-INITIALIZATION-LIST*"
   "*STACK-BACKTRACE-NUMBER-OF-FRAMES*"
   "*STACK-BACKTRACES-IN-BUG-REPORTS*"
   "*STANDARD-CHARACTER-TYPE*"
   "*STANDARD-CONFIGURATION-PATHNAME*"
   "*STANDARD-CONFIGURATION-WRITE-FILE-P*"
   "*STANDARD-EXPORT-PATHNAMES*"
   "*STANDARD-HTTP-PORT*"
   "*STANDARD-PROTOCOL*"
   "*STANDARD-SCHEME*"
   "*USER-AGENT-CAPABILITIES*"
   "ACCESS-CONTROL"
   "ACCESS-CONTROL-NAME"
   "ACCESS-CONTROL-REALM"
   "ACCESS-STATISTICS-LOG"
   "ADD-ACCESS-CONTROL-GROUP"
   "ADD-ACCESS-LOG"
   "ADD-GROUP"
   "ADD-GROUPS"
   "ADD-HOST-TO-LOAD-BALANCING-CLUSTER"
   "ADD-PERIODIC-TASK"
   "ADD-REALM"
   "ADD-REALM-SCHEME"
   "ADD-USER"
   "ADD-VIRTUAL-HOST"
   "ADD-VIRTUAL-HOST-NICK-NAME"
   "ALL-SERVERS"
   "ALLOW-USER-ACCESS-P"
   "BAD-SYNTAX-PROVIDED"
   "BASIC-URL-METERING"
   "BIND-QUERY-VALUES"
   "BUG-REPORT-ERROR"
   "CACHE-DATA"
   "CL-HTTP-SIGNATURE"
   "CLEAR-DATA-UNIVERSE"
   "CLEAR-SERVER-RESOURCE"
   "CLEAR-VIRTUAL-HOSTS"
   "CLIENT-TARGET-WINDOW-HTTP-HEADERS"
   "CLOSE-ALL-LOGS"
   "COMMON-FILE-LOG"
   "COMPUTE-TRANSMITTED-BYTES"
   "CONDITIONAL-COPY-FILE"
   "COOKIES"
   "COPY-FILE"
   "CREATE-ACCESS-LOG"
   "CRLF-CANONICALIZE-FILE"
   "CRLF-FILE-LENGTH-IN-BYTES"
   "CRLF-FILE-PARAMETERS"
   "CRLF-PATHNAME"
   "CURRENT-ACCESS-LOGS"
   "CURRENT-USER-AGENT"
   "CURRENT-USER-AGENT-VERSION"
   "CURRENT-USER-OBJECT"
   "CUSTOM-NOTIFICATION-LOG"
   "DEBUG-SERVER"
   "DEFINE-CACHED-DATA"
   "DEFINE-DISALLOWED-SUBNETS"
   "DEFINE-LOAD-BALANCING-CLUSTER"
   "DEFINE-PROXY-SUBNETS"
   "DEFINE-READ-SUBNETS"
   "DEFINE-SECURE-SUBNETS"
   "DEFINE-SHTML-ACTION"
   "DEFINE-SUBNET"
   "DEFINE-URL-CONTEXT-REMAPPINGS"
   "DEFINE-URL-EXPORT-TYPE"
   "DEFINE-URL-EXPORTS"
   "DEFINE-WRITE-SUBNETS"
   "DEINITIALIZE-RESOURCED-SERVER"
   "DELETE-PERIODIC-TASK"
   "DELETE-USER"
   "DESCRIBE-STATUS-CODES"
   "DESCRIBE-USER-CAPABILITIES"
   "DIGEST-AUTHENTICATION-RANDOM-SEED"
   "DISABLE-HTTP-SERVICE"
   "DISABLE-POST-LOGGING"
   "DISABLE-URL-METERING"
   "DOCUMENT-MOVED-PERMANENTLY"
   "DOCUMENT-MOVED-TEMPORARILY"
   "DOCUMENT-NOT-FOUND"
   "EMAIL-ADDRESS-FOR-BUG-REPORTS" 
   "ENABLE-HTTP-SERVICE"
   "ENABLE-POST-LOGGING"
   "ENABLE-URL-METERING"
   "ENSURE-CRLF-CANONICAL-FILE"
   "ENSURE-CURRENT-DATA"
   "ENSURE-CURRENT-LOG"
   "ENSURE-ESCAPED-STRING"
   "ENSURE-LIST"
   "ENSURE-MULTIPORT-STATISTICS-LOG"
   "ENSURE-UNESCAPED-STRING"
   "ESCAPED-CHARACTER-P"
   "EXPORT-TYPE-FOR-PATHNAME-TYPE"
   "EXPORT-URL"
   "EXPORT-WEB-CONFIGURATION-INTERFACE"
   "EXTENDED-COMMON-FILE-LOG"
   "FIND-ACCESS-LOG-IF"
   "GENERATE-USER-PASSWORD"
   "GET-COOKIE"
   "GET-HEADER" 
   "GET-RAW-HEADER"
   "GET-VALUE"
   "GROUP"
   "GROUP-ADD-USER"
   "GROUP-NAME"
   "GROUP-REALM"
   "GROUP-REMOVE-USER"
   "GROUP-USERS"
   "HEADER-VALUE"
   "HOST-DEFAULT-PATHNAME"
   "HTTP-LOG"
   "HTTP-SERVICE-ENABLED-P"
   "INITIALIZE-RESOURCED-SERVER"
   "INTERN-ACCESS-CONTROL"
   "INTERN-ACCESS-LOG"
   "INTERN-DATA-UNIVERSE"
   "INTERN-GROUP"
   "INTERN-KEYWORD"
   "INTERN-REALM"
   "INTERN-USER"
   "INVALID-RANGE-REQUEST"
   "IP-ADDRESS-STRING-P"
   "LAUNCH-DEMO"
   "LOAD-FILES-SAFELY"
   "LOCAL-CONTEXT"
   "LOG-ACCESS"
   "LOG-COMPRESSION-ON"
   "LOG-DYNAMIC-LOGGING-ON"
   "LOG-ENTRY-WRITER"
   "LOG-FILE-LOGGING-ON"
   "LOG-FILE-STREAM-STAYS-OPEN"
   "LOG-NOTIFICATIONS-ON"
   "MAKE-HTTP-SEARCH-SUFFIX"
   "MAKE-SERVER"
   "MAKE-SET-COOKIE-HEADER-VALUE"
   "MAP-HEADERS"
   "MAP-INDICATORS"
   "MAP-VALUES"
   "MERGE-URL"
   "MIME-CONTENT-TYPE-COPY-MODE"
   "MIME-CONTENT-TYPE-KEYWORDS"
   "MIME-MULTIPART-BOUNDARY-STRING"
   "MOVE-SERVER-TO-NEW-HOST"
   "NFILL-ARRAY"
   "NOTE-PATHNAME-EXTENSION-EXPORT-TYPE"
   "NOTIFICATION-LOG"
   "NULL-STRING-P"
   "PARSE-IMAGE-MAP"
   "PARSE-INTERNET-ADDRESSES"
   "PARSE-SHTML-TEMPLATE"
   "PATHNAME-CREATE-DIRECTORY-IF-NEEDED"
   "POST-DOCUMENT"
   "POST-FORM-VALUES"
   "POST-LOG"
   "POST-URL"
   "PRIMARY-PATHNAME-EXTENSION"
   "PRIMARY-PATHNAME-EXTENSION-FOR-EXPORT-TYPE"
   "PRINT-DATE"
   "PROPERTY-LIST"
   "PROPERTY-LIST-MIXIN"
   "PROVIDE-SERVICE"
   "QUALIFY-DOMAIN-NAME"
   "QUERY-BAGGAGE"
   "READ-FROM-ARMOR-PLATED-STRING"
   "REALM"
   "REALM-NAME"
   "REALM-SCHEME"
   "RECACHE-DATA-CACHE"
   "RECACHE-DATA-UNIVERSE"
   "REDIRECT-REQUEST"
   "REFERRER-HTTP-LOG"
   "REMOTE-USER-AGENT"
   "REMOVE-ACCESS-LOG"
   "REMOVE-DATA-CACHE"
   "REMOVE-HOST-FROM-LOAD-BALANCING-CLUSTER"
   "REMOVE-LOAD-BALANCING-CLUSTER"
   "REMOVE-VALUE"
   "REMOVE-VIRTUAL-HOST"
   "REPORT-BUG"
   "REPORT-STATUS-MESSAGE"
   "RESPONSE-WRITER-TO-INFORM-USER-VIA-EMAIL-OF-SUCCESS"
   "RESTORE-AUTHENTICATION-DATA"
   "RETURN-FORM-VALUES"
   "RUN-SERVER-INITIALIZATIONS"
   "SAVE-AUTHENTICATION-DATA"
   "SAVE-AUTHENTICATION-OBJECT"
   "SEND-MAIL-FROM"
   "SEND-MAIL-TO-GROUP"
   "SEND-MAIL-TO-USER"
   "SERVER-ADDRESS"
   "SERVER-AUTHENTICATION-METHOD"
   "SERVER-AUTHENTICATION-METHOD-STRING"
   "SERVER-CONTACT"
   "SERVER-FORM-ALIST"
   "SERVER-GET-HEADER"
   "SERVER-HOST"
   "SERVER-HOST-DOMAIN-NAME"
   "SERVER-HOST-IP-ADDRESS"
   "SERVER-HOST-LOCAL-PORT"
   "SERVER-HTTP-VERSION"
   "SERVER-HTTP-VERSION-STRING"
   "SERVER-LIFE-TIME"
   "SERVER-LIVE-CONNECTION-P"
   "SERVER-LOCAL-HOST-DOMAIN-NAME"
   "SERVER-METHOD"
   "SERVER-RELATIVE-URL-STRING"
   "SERVER-REQUEST-TIME"
   "SERVER-SOFTWARE-VERSION"
   "SERVER-STREAM"
   "SERVER-TIMEOUT"
   "SERVER-TRANSLATED-PATHNAME"
   "SERVER-URL"
   "SERVER-URL-SEARCH-KEYS"
   "SERVER-USER-AGENT"
   "SERVER-USER-OBJECT"
   "SET-COOKIE-HTTP-HEADERS"
   "SET-HTTP-LOGICAL-DIRECTORY-LOCATION"
   "SET-MAXIMUM-NUMBER-OF-CONNECTIONS"
   "SET-SERVER-STATUS"
   "SET-STANDARD-HTTP-PORT"
   "SHOW-PERIODIC-TASKS"
   "SHOW-URL"
   "SHOW-URL-HEADERS"
   "SORTED-ACCESS-CONTROLS"
   "SORTED-GROUPS"
   "SORTED-REALMS"
   "SORTED-USERS"
   "STANDARD-DATA-UNIVERSE"
   "STREAM-COPY-UNTIL-EOF"
   "STREAM-DECODE-CRLF-UNTIL-EOF"
   "STREAM-ENCODE-CRLF-UNTIL-EOF"
   "STRING-APPEND"
   "STRING-ESCAPE-SPECIAL-CHARS"
   "STRING-SEARCH"
   "STRING-UNESCAPE-SPECIAL-CHARS"
   "SYMBOLIZE"
   "UNEXPORT-URL"
   "UNINTERN-ACCESS-CONTROL"
   "UNINTERN-DATA-UNIVERSE"
   "UNINTERN-GROUP"
   "UNINTERN-REALM"
   "UNINTERN-USER"
   "UPDATE-USER"
   "USER-ADD-GROUP"
   "USER-AGENT-CAPABILITY-P"
   "USER-EMAIL-ADDRESS"
   "USER-GROUPS"
   "USER-NAME"
   "USER-PASSWORD-DIGEST"
   "USER-PERSONAL-NAME"
   "USER-PERSONAL-NAME+EMAIL"
   "USER-QUALIFIED-NAME"
   "USER-REALM"
   "VALID-CRLF-CACHE-FILE-P"
   "VALID-DOMAIN-NAME-STRING-P"
   "VALID-SEARCH-URL-P"
   "WHITE-SPACE-CHAR-P"
   "WITH-CGI-ENVIRONMENT"
   "WITH-CONDITIONAL-GET-RESPONSE"
   "WITH-COOKIE-VALUES"
   "WITH-DATA-UNIVERSE"
   "WITH-IMAGE-COORDINATES"
   "WITH-LOCAL-CONTEXT"
   "WITH-LOCAL-SCHEME"
   "WITH-METERED-RESPONSE"
   "WITH-MIME-MULTIPART-BLOCK"
   "WITH-RESPONSE-ENSURED"
   "WITH-SERVER-INTERFACE-ENVIRONMENT"
   "WITH-STRING-FOR-NULL-STREAM"
   "WITH-SUBNET-ACCESS-CONTROL"
   "WITH-SUCCESSFUL-RESPONSE"
   "WITH-USER-EMAIL-ADDRESS"
   "WITH-VALUE-CACHED"
   "WRITE-ACCESS-LOG-ENTRY"
   "WRITE-COMMON-LOGFILE-ENTRY"
   "WRITE-DIRECTORY-LISTING"
   "WRITE-DOCUMENT"
   "WRITE-DOCUMENT-HEADERS"
   "WRITE-INDEXED-DIRECTORY-LISTING"
   "WRITE-TO-ARMOR-PLATED-STRING"))

;;;------------------------------------------------------------------- 
;;;
;;; IMPORTING INTERNAL OR CIRCULAR SYMBOLS
;;;

;; Eval-when needed due to compile-time side effects of EXPORT in LispWorks
(eval-when (:compile-toplevel :execute :load-toplevel)

;; circular symbol sharing
(mapc #'(lambda (x) (import (intern x :http) :html2))
      '("*FILE-UPLOAD-DEFAULT-DIRECTORY*"
        "FAST-FORMAT"
        "FILE-UPLOAD-UNPACK-QUERY-BAGGAGE"
        "NAME"				;share slot name for input-types
        "WITH-STRING-FOR-NULL-STREAM"))

(export (intern "FAST-FORMAT" :html2) :html2)

(mapc #'(lambda (x) (import (intern x :http) :rss2.0)) '("FAST-FORMAT" "WRITE-MIME-CONTENT-TYPE"))

(mapc #'(lambda (x) (import (intern x :http)  :url))
      '("%FAST-POSITION-IF"
        "%LOAD-BALANCED-URL"
        "%STRING="
        "%STRING-EQUAL"
        "*FRAGMENT-DELIMITER-CHARACTER*"
        "*KEYWORD-PACKAGE*"
        "*SECURE-SUBNETS*"
        "*SERVER*"
        "*STANDARD-CHARACTER-TYPE*"
        "*WHITE-SPACE-CHARS*"
        "ALLOCATE-STRONG-ENTITY-TAG"
        "CHAR-POSITION"
        "CHECK-CHARACTER-SET-FOR-MIME-CONTENT-TYPE-TEXT"
        "DATA-UNIVERSE"
        "DC-REVALIDATION-INTERVAL" 
        "DC-WIRED-P"
        "DIRECTORY-EXPORT-TYPE-P"
        "DIRECTORY-TYPE-EXPORTS-PATHNAME-EXPORT-TYPE-P"
        "FAST-FORMAT"
        "GET-VALUE"
        "GIF-IMAGE-DIMENSIONS"
        "GOOD-RESPONSE-FUNCTION-P"
        "HIERARCHICAL-DIRECTORY-EXPORT-TYPE-P"
        "INHERIT-EXPORT-PARAMETERS"
        "IP-ADDRESS-STRING-P"
        "JPEG-IMAGE-DIMENSIONS"
        "MAP-INDICATORS"
        "MAP-VALUES"
        "PARSE-COMMA-SEPARATED-HEADER"
        "PATHNAME-PRIMARY-EXTENSION"
        "PLIST"
        "PNG-IMAGE-DIMENSIONS"
        "PROPERTY-LIST"
        "PROPERTY-LIST-MIXIN"
        "REMOVE-VALUE"
        "STRING-SEARCH="
        "STRING-UNESCAPE-SPECIAL-CHARS"
        "TOKENIZE-EXPORTED-PATHNAME-EXTENSION"
        "WITH-STRING-TRIM-BOUNDS"))
)						;close eval-when

(eval-when (:execute :load-toplevel)
(mapc #'(lambda (x) (import (intern x :html2) :netscape4.0))
      `("%WRITE-COMMAND-KEY-ARG"
        "%ISSUE-COMMAND"
        "%WITH-ENVIRONMENT"
        "ISSUE-COMMAND"
        "ISSUE-COMMAND*"
        "WITH-ENVIRONMENT")))   ;close eval-when

(eval-when (:execute :load-toplevel)

(mapc #'(lambda (x) (import (intern x :html2) :html4.0))
      '("*FILE-UPLOAD-DEFAULT-DIRECTORY*"
        "*OPEN-FORM*"
        "*OUTPUT-STREAM*"
        "*SECTION-LEVEL*"                            ;interoperate between different packages
        "*SELECT-CHOICES-MAX-DEFAULT-SIZE*"
        "*SPECIAL-CHARACTER-TRANSLATION-ALIST*"
        "%WITH-ENVIRONMENT"
        "CHECK-VALUE-TYPE"
        "FILE-UPLOAD-MAKE-QUERY"
        "ISO-CHARACTER-CODE-FROM-KEYWORD"
        "ISSUE-COMMAND"
        "ISSUE-COMMAND*"
        "LISP-TYPE"					;input-type slot
        "NICKNAMES"					;input-type slot
        "TYPE-ARG"					;input-type slot
        "WITH-ENVIRONMENT"
        "WRITE-STRING-QUOTING-SPECIALS"
        "VERIFY-QUERY-NAME"))

(mapc #'(lambda (x) (import (intern x :html3.2) :html4.0))
      '("*ENUMERATION-FUNCTION*"))
(mapc #'(lambda (x) (import (intern x :ns1.1) :html4.0))
      '("%WRITE-WIDTH-ARGUMENT"))
(mapc #'(lambda (x) (import (intern x :ns2.0) :html4.0))
  '("SPECIAL-TARGET-WINDOW-NAME"
    "TARGET-WINDOW-NAME-STRING"))
(mapc #'(lambda (x) (import (intern x :http) :html4.0))
      '("*STANDARD-CHARACTER-TYPE*"
        "ACCESS-KEY"
        "ACCESS-KEY-DEFAULT"
        "BOUNDING-SHAPE"
        "CLASS"
        "CLASS-DEFAULT"
        "DESTINATION"
        "DIRECTION"
        "DIRECTION-DEFAULT"
        "FAST-FORMAT"
        "EVENTS"
        "EVENTS-DEFAULT"
        "HTML-GENERATION-ERROR"
        "ID" 
        "ID-DEFAULT"
        "IM-ACCESS-KEY-DEFAULT"
        "IM-CLASS-DEFAULT"
        "IM-DIRECTION-DEFAULT"
        "IM-EVENTS-DEFAULT"
        "IM-ID-DEFAULT"
        "IM-LANGUAGE-DEFAULT"
        "IM-STYLE-DEFAULT"
        "IM-TAB-INDEX-DEFAULT"
        "IM-TITLE-DEFAULT" 
        "LANGUAGE" 
        "LANGUAGE-DEFAULT" 
        "NAME"
        "REGION-ACCESS-KEY"
        "REGION-BOUNDING-SHAPE"
        "REGION-CLASS"
        "REGION-DESTINATION"
        "REGION-DIRECTION"
        "REGION-EVENTS"
        "REGION-ID"
        "REGION-LANGUAGE" 
        "REGION-LIST"
        "REGION-NAME"
        "REGION-STYLE"
        "REGION-TAB-INDEX"
        "REGION-TITLE" 
        "STYLE" 
        "STYLE-DEFAULT"
        "SYMBOLIZE"
        "TAB-INDEX" 
        "TAB-INDEX-DEFAULT" 
        "TITLE" 
        "TITLE-DEFAULT"
        "URL-DEFAULT"
        "WITH-STRING-FOR-NULL-STREAM"
        "WRITE-MIME-CONTENT-TYPE-KEYWORD-AS-STRING"))

(mapc #'(lambda (x) (export (intern x :html4.0) :html4.0))
      '("*OUTPUT-STREAM*"
        "*FILE-UPLOAD-DEFAULT-DIRECTORY*"
        "FAST-FORMAT"
        "WRITE-STRING-QUOTING-SPECIALS"))

(mapc #'(lambda (x) (import (intern x :html4.0) :http))
      '("*CL-HTTP-DOCUMENT-LOOK*"
        "CL-HTTP-LOOK"
        "WITH-CL-HTTP-HTML-DOCUMENT"))
) ;close eval-when

(eval-when (:execute :load-toplevel)
(mapc #'(lambda (x) (import (intern x :html4.0) :xhtml1.0))
      '("%ISSUE-COMMAND"
        "%WITH-ENVIRONMENT"
        "%WRITE-COMMAND-KEY-ARG"
        "%WRITE-ID-ARGUMENT"
        "%WRITE-ID-ARGUMENT-HANDLING-XHTML-BACKWARD-COMPATIBLY"
        "%WRITE-CLASS-ARGUMENT"
        "%WRITE-TITLE-ARGUMENT"
        "%WRITE-STYLE-ARGUMENT"
        "%MAKE-WITH-HTML-DOCUMENT-ENV"))) ;close eval-when

(eval-when (:execute :load-toplevel)
(mapc #'(lambda (x)
          (let ((sym (intern x :html4.0)))
            (import sym :xhtml1.0)
            (export sym :xhtml1.0)))
      '("*XHTML-BACKWARD-COMPATIBLE-IDENTIFIERS*"
        "XHTML-CHECK-BACKWARD-COMPATIBLE-IDENTIFIER-STRING"))) ;close eval-when

;;;------------------------------------------------------------------- 
;;;
;;; IMPORTING AND RE-EXPORTING EXTERNAL SYMBOLS
;;;

;; Export all the SCRIPT external symbols from the markup packages.
(eval-when (:execute :load-toplevel)
(let ((ancestor-pkg (find-package :script))
      (target-packages (mapcar #'find-package '(:netscape2.0 :netscape3.0 :netscape4.0 :html3.2 :html4.0))))
  (do-external-symbols (sym ancestor-pkg)
    (dolist (pkg target-packages)
      (export sym pkg)))))   ;close eval-when

;; Make sure we're exporting a compete set of HTML3.2 symbols.
(eval-when (:execute :load-toplevel)
(let* ((ancestor-pkg (find-package :html2))
       (pkg (find-package :html3.2))
       (shadowed-symbols (mapcar #'symbol-name (package-shadowing-symbols pkg))))
  (do-external-symbols (sym ancestor-pkg)
    (let ((name (symbol-name sym)))
      (unless (member name shadowed-symbols :test #'equalp)   ; don't export shadowed symbols
        (import sym pkg)
        (export sym pkg))))))   ;close eval-when 

;; Make sure we're exporting a compete set of HTML4.0 symbols.
(eval-when (:execute :load-toplevel)
(let* ((ancestor-pkg (find-package :html3.2))
       (pkg (find-package :html4.0))
       (shadowed-symbols (mapcar #'symbol-name (package-shadowing-symbols pkg))))
  (do-external-symbols (sym ancestor-pkg)
    (let ((name (symbol-name sym)))
      (unless (member name shadowed-symbols :test #'equalp)   ; don't export shadowed symbols
        (import sym pkg)
        (export sym pkg))))))   ;close eval-when

;; Make sure we're exporting a compete set of XML1.0 symbols.
(eval-when (:execute :load-toplevel)
(let* ((ancestor-pkg (find-package :html4.0))
       (pkg (find-package :xhtml1.0))
       (shadowed-symbols (mapcar #'symbol-name (package-shadowing-symbols pkg))))
  (do-external-symbols (sym ancestor-pkg)
    (let ((name (symbol-name sym)))
      (unless (member name shadowed-symbols :test #'equalp)   ; don't export shadowed symbols
        (import sym pkg)
        (export sym pkg))))))   ;close eval-when

#+ignore
(defun package-external-symbols (pkg &aux symbols)
  (do-external-symbols (sym (find-package pkg))
    (push sym symbols))
  (sort symbols #'string< :key #'symbol-name))

#|

(set-difference (cl-user::package-external-symbols :html3.2) (cl-user::package-external-symbols :html4.0) :test #'equal :key #'symbol-name)
                                    
|#

#+ignore
(defun package-inherited-exteernal-symbols (package &aux symbols)
  (let ((pkg (find-package package)))
    (do-external-symbols (sym pkg)
      (unless (eq pkg (symbol-package sym))
        (push sym symbols)))
    (sort symbols #'string< :key #'symbol-name)))
;;;------------------------------------------------------------------- 
;;;
;;; USER PACKAGE 
;;;

;; Package for portable user application code.
(defpackage http-user
  (:use future-common-lisp www-utils url html http))
